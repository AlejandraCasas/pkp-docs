---
title: Files - Technical Documentation - OJS|OMP|OPS
---

# Files

Files are managed in a private directory outside of the web root. This ensures that the application can prevent unauthorized access to files uploaded by the user or generated by the system.

The files directory is specified in the `files_dir` setting in the configuraton file.

## File Service

The File Service is a helper class to read and write files in this directory. When a file is added or deleted, it will add or remove a row from the `files` table in the database.

Add a file.

```php
$fileId = Services::get('file')->add('/absolute/path/to/source.txt', 'destination.txt');
```

Delete a file.

```php
Services::get('file')->delete($fileId);
```

Get the relative path to a file in the file directory.

```php
$path = Services::get('file')->getPath($fileId);
```

Download a file in the file directory.

```php
Services::get('file')->download($fileId, 'my-special-file.txt');
```

Generate a safe filename from any string.

```php
$title = $publication->getLocalizedFullTitle();
$path = Services::get('file')->getPath($fileId);
$filename = Services::get('file')->formatFilename($path, $title);
```

File relationships in the database should always refer to the `file_id` in the `files` table. Use a foreign key when possible.

## Filesystem

The File Service is a small wrapper around [Flysystem 1.x](https://flysystem.thephpleague.com/v1/docs/). Access the library directly to use the [Filesystem API](https://flysystem.thephpleague.com/v1/docs/usage/filesystem-api/).

Check if a file exists.

```php
$path = Services::get('file')->getPath($fileId);
if (Services::get('file')->fs->has($path)) {
	...
}
```

Get the mimetype of a file.

```php
$path = Services::get('file')->getPath($fileId);
$mimetype = Services::get('file')->fs->getMimetype($path);
```

By default, the File Service instantiates the [local file system adaptor](https://flysystem.thephpleague.com/v1/docs/adapter/local/) and configures it to use the `files_dir` directory. Adaptors are available for other file systems such as AWS and Azure. Use the Flysystem API, not PHP's file functions, in order to ensure operations are compatible with all of the filesystem adaptors.

## Context Files

Files for a journal, press or preprint server are stored in distinct subdirectories. Get the path to the context directory to add a file to a context.

```php
$context = $request->getContext();
$appFileDirectories = \Application::get()->getFileDirectories();
$path = $appFileDirectories['context'] . $context->getId();
$fileId = Services::get('file')->add('source.txt', $path . '/destination.txt');
```

## Submission Files

Files for a submission are stored in distinct subdirectories. Use the Submission File Service to get a path to a submission's directory.

```php
$path = Services::get('submissionFile')->getSubmissionDir($contextId, $submissionId);
$fileId = Services::get('file')->add('source.txt', $path . '/destination.txt');
```

Read more about working with [Submission Files](./submission-files).

## Public Files

> The public files directory is deprecated and should not be used for new features.
{:.warning}

Public files are accessible to anyone and may include files uploaded to a user signature or bio. These files are stored in a public directory inside the web root, so that they can be accessed directly by HTTP request.

Use the `PublicFileManager` to read and write public files.

## Temporary Files

Temporary files are used to stage changes before they are applied. For example, temporary files are used to upload a new journal logo, but the logo will not be changed until the form is saved.

Learn how to use temporary files in the [REST API Guide](http://localhost:4000/dev/api/#temporary-files).
